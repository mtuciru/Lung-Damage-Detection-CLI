# CLI ПРИЛОЖЕНИЕ ДЛЯ ОБНАРУЖЕНИЯ ПОРАЖЕНИЙ ЛЕГКИХ

___

Данный репозиторий содержит код CLI приложения для обучения и запуска модели для обнаружения поражений легких. Модель основанна на архитектуре U-Net и реализована с помощью фреймворка pytorch для python. 

## УСТАНОВКА

___

<u>Для работы проекта необходим python ==3.10.*</u>

Скачайте проект:
```shell
git clone <repo-name> && cd <project-dir>
```
Установите зависимости проекта:
```shell
pdm install
```

## РАЗРАБОТКА И ИСПОЛЬЗОВАНИЕ

___

<u>Скопируйте .env.example и переименуйте его в .env</u>

<b>Переменные среды</b>

    PATH_TO_DATA=  # директория, содержащая датасет
    DCM_DATA_DIR=  # директория внутри PATH_TO_DATA, содержащая dcm файлы
    PNG_DATA_DIR=  # директория внутри PATH_TO_DATA, содержащая png файлы
    TRAIN_SET=  # количество изображений для обучения модели
    TEST_SET=  # количество изображений для теста модели
    VAL_SET=  # количество изображений для валидации модели
    N_EPOCHS=200 # количество эпох обучения 
    LR=1e-4 # коэффициент скорости обучения / learning rate
    BATCH_SIZE=4 # размер пакета/батча
    IMG_SIZE=512 # ширина и высыта изображений
    BACKBONE=resnet101 # имя backbone модели
    SAVE_PATH=  # путь файла для сохранения обученной модели
    OUT_PATH=  # директория для результатов работы модели
    USE_AUGMENTATION=false # если true, применяется аугментация данных
    SEED=5 # параметр seed для numpy.random.seed

Поддерживаемые значения BACKBONE:
* resnet18
* resnet34
* resnet50
* resnet101 
* resnet152
* vgg16
* vgg19
* densenet121
* densenet161
* densenet169
* densenet201

Запуск приложения из директории проекта
```shell
pdm run cli
```

Приложение поддерживает следующие команды:
* help - вывод списка команд
* exit - выйти из приложения
* train - запуск обучения модели
* test - запуск теста модели
* inference - запуск модели (только dcm файлы)

Весь код размещен в директории src.

Для обучения модели разместите в PATH_TO_DATA/DCM_DATA_DIR dcm файлы с результатами КТ легких, а так же png маски в PATH_TO_DATA/PNG_DATA_DIR. Далее измените переменные среды TRAIN_SET, VAL_SET и TEST_SET в зависимости от объема вашего датасета. Каждую эпоху сохраняется state dict модели. Если файл SAVE_PATH существует, то модель будет загружена с помощью этого файла при перезапуске приложения.

Если USE_AUGMENTATION = true, то некоторые изображения будут обрезаны, повернуты и отражены по вертикали.

По завершении теста приложение выводит метрики.

<b>Метрики</b>
- precision
- recall
- f1 score
- jaccard coefficient
- dice coefficient

Для запуска модели (команда inference), введите путь к dcm файлу или путь к директории с dcm файлами.

Результаты будут расположены в директории OUT_PATH.

## ЛИЦЕНЗИЯ

___

[MIT](LICENSE)
