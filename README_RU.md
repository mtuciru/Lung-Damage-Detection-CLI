# CLI ПРИЛОЖЕНИЕ ДЛЯ ОБНАРУЖЕНИЯ ПОРАЖЕНИЙ ЛЕГКИХ

___

Данный репозиторий содержит код CLI приложения для обучения и запуска модели для обнаружения поражений легких. Модель основанна на архитектуре U-Net и реализована с помощью фреймворка pytorch для python. 

## УСТАНОВКА

___

<u>Для работы проекта необходим python ==3.10.*</u>

Установка из PyPI:
```shell
pip install LungDamageDetectionCLI
```
Установка из репозитория:
```shell
git clone <repo-name> && cd <project-dir>
pdm install
```

## РАЗРАБОТКА И ИСПОЛЬЗОВАНИЕ

___

Запуск приложения из директории проекта
```shell
pdm run ldd-cli SUBCOMMAND
```

Приложение поддерживает следующие команды:
* train - запуск обучения модели
* test - запуск теста модели
* inference - запуск модели

Вы можете скопировать .env.example и переименовать его в .env</u>

<b>Переменные среды</b>

    PATH_TO_DATA=  # директория, содержащая датасет
    DCM_DIR=  # директория внутри PATH_TO_DATA, содержащая dcm файлы
    PNG_DIR=  # директория внутри PATH_TO_DATA, содержащая png файлы
    TRAIN_SET=  # количество изображений для обучения модели
    TEST_SET=  # количество изображений для теста модели
    VAL_SET=  # количество изображений для валидации модели
    EPOCHS=  # количество эпох обучения 
    LR=  # коэффициент скорости обучения / learning rate
    BATCH_SIZE=  # размер пакета/батча
    IMG_SIZE=512 # ширина и высыта изображений
    BACKBONE=resnet101 # имя backbone модели
    SAVE_PATH=  # путь файла для сохранения обученной модели
    OUT_PATH=  # директория для результатов работы модели
    INPUT_PATH=  # dcm файл или директория с dcm файлами
    USE_AUGMENTATION=false # если true, применяется аугментация данных
    SEED=5 # параметр seed для numpy.random.seed

Или передавать желаемые значения через аргументы в командной строке (названия аргументов не чувствительны к регистру).

Поддерживаемые значения BACKBONE:
* resnet18
* resnet34
* resnet50
* resnet101 
* resnet152
* vgg16
* vgg19
* densenet121
* densenet161
* densenet169
* densenet201

Весь код размещен в директории src.

Для обучения модели разместите в PATH_TO_DATA/DCM_DIR dcm файлы с результатами КТ легких, а так же png маски в PATH_TO_DATA/PNG_DIR. Далее измените переменные среды TRAIN_SET, VAL_SET и TEST_SET в зависимости от объема вашего датасета. Каждую эпоху сохраняется state dict модели. Если файл SAVE_PATH существует, то модель будет загружена с помощью этого файла при перезапуске приложения.

Если USE_AUGMENTATION = true, то некоторые изображения будут обрезаны, повернуты и отражены по вертикали.

По завершении теста приложение выводит метрики.

<b>Метрики</b>
- precision
- recall
- f1 score
- jaccard coefficient
- dice coefficient

Для запуска модели передайте путь к dcm файлу или путь к директории с dcm файлами в переменную INPUT_PATH.

Результаты будут расположены в директории OUTPUT_PATH.

## ЛИЦЕНЗИЯ

___

[MIT](LICENSE)
